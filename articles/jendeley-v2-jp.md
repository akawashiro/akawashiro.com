# jendeley v2 - インクリメンタルな曖昧検索の手法とその実装 <!-- omit in toc -->
[jendeley](https://zenn.dev/a_kawashiro/articles/a2170f967f9508)というJSONベースの文書管理ソフトウェアを作って日々使っています。先日、バージョン2にアップデートするに当たって、長らく欲しかった文書全体に対するインクリメンタルな曖昧検索機能を実装しました。

## 目次 <!-- omit in toc -->
- [jendeleyとは](#jendeleyとは)
- [インクリメンタルな曖昧検索](#インクリメンタルな曖昧検索)
  - [インクリメンタルな曖昧検索とは](#インクリメンタルな曖昧検索とは)
  - [jendeleyでの動作の様子](#jendeleyでの動作の様子)
  - [求められる性能](#求められる性能)
- [インクリメンタル全文ファジー検索の実装](#インクリメンタル全文ファジー検索の実装)
  - [ナイーブな実装](#ナイーブな実装)
  - [接尾辞木を用いた実装](#接尾辞木を用いた実装)
    - [Ukkonenのアルゴリズムを用いた接尾辞木の構築](#ukkonenのアルゴリズムを用いた接尾辞木の構築)
- [まとめ](#まとめ)
- [参考](#参考)
- [連絡先](#連絡先)

## jendeleyとは
まずはじめにjendeleyを簡単に紹介します。jendeleyとは僕が作っている文書管理ソフトウェアです。
- データベースをプレインなJSONで保持すること
- サーバではなくローカルのPCで動作すること
- node.jsとブラウザが動く環境ならOSを問わずどこでも動作すること

の3つの原則のもとに開発しています。半年ほど前の2022年11月に開発を開始し、先日v2.0をリリースしました。

2022年1月にリリースした jendeley v1.0はタイトル、著者、ユーザの付与したタグ、ユーザの書いたコメントに対してキーワードで文書を絞り込むことができました。しかし文書の中身に対して検索を行うことはできませんでした。

僕は昔から[検索エンジンを自作する](https://a-kawashiro.hatenablog.com/entry/2020/03/06/192527)ことに興味がありこともあり、jendeleyに全文検索を実装したいと思っていました。更に、常日頃から[fzf](https://github.com/junegunn/fzf)というファジー検索ツールを常用していることもあり、実装するなら文書全体に対するインクリメンタルな曖昧検索を実装したいと考えていました。

## インクリメンタルな曖昧検索
### インクリメンタルな曖昧検索とは
「インクリメンタルな曖昧検索」とは、文字を一文字打つごとに新たに検索が行われ、また入力したキーワードに完全に一致しなくてもマッチするような検索のことです。[fzf](https://github.com/junegunn/fzf)はCLIで動作するインクリメンタルな曖昧検索ツールであり、ターミナルに組み込んで履歴の検索を行ったり、vimに組み込んでカレントディレクトリ以下のソースコードを検索することができます。

TODO: gif
上の画像は[sold](https://github.com/akawashiro/sold)のソースコードをfzfを使って全文検索している様子です。fzfは曖昧検索ができるので"Elf hash"で検索して  CH**E**CK(fte**l**l(**f**p) == gnu_**hash**_fileoffset); がヒットしています。また一文字入力するごとに検索結果が変わっています。このインクリメンタルな曖昧検索は非常に便利で、僕はファイル検索、キーワード検索、コマンドの履歴検索を日常的に使っています。

### jendeleyでの動作の様子
### 求められる性能
- 100ms
- 文書の数
- 文書の長さ
## インクリメンタル全文ファジー検索の実装
### ナイーブな実装
### 接尾辞木を用いた実装
#### Ukkonenのアルゴリズムを用いた接尾辞木の構築
## まとめ
## 参考
## 連絡先
この記事に誤りがあった場合は[Twitter](https://twitter.com/a_kawashiro)等で連絡をください。修正します。その他の連絡先は [https://akawashiro.github.io/](https://akawashiro.github.io/#links) にあります。